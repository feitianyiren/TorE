# Tornado Enhancement Package Readme

## Introduction

TorE is an enhancement package of [Tornado](http://www.tornadoweb.org/) web framework which provides rapid ways to develop template and ajax based web applications. It is compatible with Python 3.2 and above and has following new features:

1. Built-in [Json Messaging](https://github.com/shajunxing/Json_Messaging) compatible message server with WebSocket support.
2. Template engine has been enhanced and ASP.NET like [Code Behind](http://support.microsoft.com/kb/303247) style has been supported.
3. Other enhancements such as authentication, authorization, Json handling and so on.

## Changelog

### 2012.10.28

* Tornado version 2.4 is supported.

## Usage

### tore.start_server(**settings)

A simple way to start Tornado with just one statement. It's parameters are listed below, most of them are enhanced from Tornado and some are newly added.

#### root_dir

(New) The base dir of all the other settings. Default is os.getcwd()

#### handlers

(Enhanced) URL mappings, same as the param of tornado.web.Application's constructor. Some default mappings are added:

1. /web: Mapped to "root_dir/web" dir which contains static and template files. The accessing rule is: "*.t" are treated as template files, "*.py" are theated as template code files and direct access is forbidden, other files are treated as static files and will be handled by tornado.web.StaticFileHandler.
2. /messaging: The WebSocket address of message service. It shares the same port with application.
3. /: This root url will be redirected to /web/index.t, which is the default homepage and must be existed.

#### port

(Enhanced) HTTP and WebSocket port, default is 80.

#### gzip

A boolean value to indicate whether or not to enable HTTP compression. Default is disabled.

#### encryption

(New) A boolean value to indicate whether or not to enable HTTPS. If enabled, "certfile" and "keyfile" params must be set. Default is disabled.

#### certfile

(New) SSL public key filename. Same as the param of tornado.httpserver.HTTPServer.

#### keyfile

(New) SSL private key filename. Same as the param of tornado.httpserver.HTTPServer.

#### debug

(Enhanced) A boolean value to indicate whether or not to enable debug mode, same as param of tornado.web.Application but some new features are added:

1. If disabled, all the HTTP output originally generated by Tornado will be shutdown in order to improve performance.
2. If enabled, output of tore.web.JsonHandler will be "human readable", that is, Json will not be ascii escaped and will be well formatted by line break and indent.
3. If enabled, each request will trigger reloading of template and code file. Same as Tornado's default behavor.

#### authentication

(New) A function which format is "foo(username, password)". tore.web.authenticated decorator will get user name and password from HTTP basic authentication and try to call this function. If this function exists and the return value is False, An 401 error will be raised, or the user name will be set as "current_user". Default is None.

#### authorization

(New) A function which format is "foo(username, path)". tore.web.authorized decorator will call this function using current user name and request url. If this function exists and the return value is False, An 403 error will be raised. Default is None.

#### messaging_tcp_port

(New) TCP port of messaging service, Which will be disabled if set to None. Default is None.

#### messaging_udp_port

(New) UDP port of messaging service, Which will be disabled if set to None. Default is None.

### Enhanced Template Engine

Tormado's template engine is enhanced by tore.web.RequestHandler, tore.web.Loader, and tore.web.Template. Now the new template engine will search the file named "<template file name>.py" and merge into the code generated by template, just like ASP.NET Code Behind style.

See examples for more information.

### tore.web.JsonHandler

Inherit from tornado.web.RequestHandler and optimized for Ajax and RESTful Web Service. Some new methods are added:

1. write_object(self, obj): Output Python object to Json format. The "Content Type" will be set to "application/json; charset=UTF-8".
2. write_text(self, txt): Directly output Json text. The "Content Type" will be set to "application/json; charset=UTF-8". Notice this method will not do encoding and gramma examination.
3. get_params_as_dict(self): Get request params wrapped as dict, including query strings followed by url(GET) and request body(POST).
4. get_body_as_text(self): Get text formatted requese body. Default encoding is UTF-8.
5. get_body_as_object(self): Convert Json text formatted request body to Python object. For example, Json string can be submitted by jQuery.ajax(), but notice that "processData" must be set to "false".

### tore.web.authenticated Decorator

It is used to decorate get, post ... methods and do HTTP basic authentication. see tore.start_server() for more information.

TorE's template engine is decorated by default.

### tore.web.authorized Decorator

It is used to decorate get, post ... methods and do authorizations. see tore.start_server() for more information.

TorE's template engine is decorated by default.

These two decorators can be used at same time, for example:

    @tore.web.authenticated
    @tore.web.authorized
    def get(self, *args, **kwargs):
        ...

### Json Messaging message engine

Fully compatible with [Json Messaging](https://github.com/shajunxing/Json_Messaging) written by Node.JS. see tore.start_server() for more information.

Only latest version of Chrome and Firefox are supported.

Inside application, tore.messaging.exchange.push(message, destination) can be used to publish messages directly without going through TCP or UDP.

